<div class="step-three-container">
  <h2 class="text-xl font-medium mb-6">Adicione os patrocinadores</h2>
  
  <div *ngIf="loading" class="flex justify-center my-4">
    <div class="spinner"></div>
  </div>
  
  <div [formGroup]="sponsorsForm">
    <div formArrayName="items">
      @for (item of sponsorItems.controls; track $index) {
        <div [formGroupName]="$index" class="sponsor-item mb-6 pb-6 border-b border-gray-200 last:border-0">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <!-- Name -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
              <input 
                type="text" 
                class="form-input w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                placeholder="Nome do patrocinador"
                formControlName="name">
              @if (item.get('name')?.invalid && item.get('name')?.touched) {
                <div class="text-red-500 text-sm mt-1">
                  Nome é obrigatório
                </div>
              }
            </div>
            
            <!-- Category -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
              <select 
                class="form-select w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
                formControlName="categoryId"
                [disabled]="loading">
                <option value="" disabled selected>Selecione uma categoria</option>
                @for (category of sponsorCategories; track category.id) {
                  <option [value]="category.id">{{ category.name }}</option>
                }
              </select>
              @if (item.get('categoryId')?.invalid && item.get('categoryId')?.touched) {
                <div class="text-red-500 text-sm mt-1">
                  Categoria é obrigatória
                </div>
              }
            </div>
            
            <!-- Action Buttons -->
            <div class="flex items-end gap-2">
              <button 
                type="button" 
                class="upload-button p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600"
                (click)="fileInput.click()">
                <mat-icon>image</mat-icon>
                <input 
                  #fileInput
                  type="file" 
                  accept="image/*" 
                  class="hidden"
                  (change)="uploadSponsorLogo($event, $index)">
              </button>
              
              <button 
                type="button" 
                class="add-button p-2 bg-green-500 text-white rounded-full hover:bg-green-600"
                (click)="addSponsorItem()">
                <mat-icon>add</mat-icon>
              </button>
              
              <button 
                type="button" 
                class="delete-button p-2 bg-red-500 text-white rounded-full hover:bg-red-600"
                (click)="removeSponsorItem($index)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          
          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
            <textarea 
              class="form-textarea w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary"
              rows="4"
              placeholder="Descreva o conteúdo"
              formControlName="description"></textarea>
            @if (item.get('description')?.invalid && item.get('description')?.touched) {
              <div class="text-red-500 text-sm mt-1">
                Descrição é obrigatória
              </div>
            }
          </div>

          <!-- Display selected file name if available -->
          @if (item.get('logoImage')?.value) {
            <div class="mt-2 flex items-center justify-between">
              <div class="text-sm text-green-600">
                Arquivo selecionado: {{ getFileName(item.get('logoImage')?.value) }}
              </div>
              <button 
                type="button" 
                class="remove-image-button p-2 bg-red-500 text-white rounded-full hover:bg-red-600"
                (click)="removeSponsorLogo($index)">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          }
          
          <!-- Image Preview -->
          @if (item.get('logoImage')?.value) {
            <div class="mt-3 image-preview">
              <img 
                [src]="item.get('logoImage')?.value" 
                alt="Logo preview" 
              />
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
